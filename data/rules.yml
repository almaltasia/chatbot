version: "3.1"

rules:
  - rule: Say greet anytime the user says greet
    steps:
      - intent: greet
      - action: utter_greet

  - rule: Say goodbye anytime the user says goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - rule: Say 'I am a bot' anytime the user challenges
    steps:
      - intent: bot_challenge
      - action: utter_iamabot

  - rule: Say thanks anytime the user says thank_you
    steps:
      - intent: thank_you
      - action: utter_thanks

  - rule: please rephase when
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - rule: Fallback rule
    steps:
      - intent: nlu_fallback
      - action: action_default_fallback

  - rule: Trigger report process when user wants to report
    steps:
      - intent: report_case
      - action: utter_report_starts
      - action: utter_ask_report_confirmation

  - rule: Activate report form after confirmation
    steps:
      - intent: affirm
      - action: utter_report_started
      - action: report_form
      - active_loop: report_form

  - rule: Cancel report after user denies confirmation
    steps:
      - intent: deny
      - action: utter_report_cancelled

  - rule: Handle cancellation during report process
    condition:
      - active_loop: report_form
        steps:
          - intent: cancel_report
          - action: action_cancel_report
          - action: utter_report_cancelled
          - active_loop: null

  - rule: Ask for disability details when user has disability
    condition:
      - active_loop: report_form
      - slot_was_set:
        disability: Ya
    steps:
      - action: utter_ask_disability_details

  - rule: Ask for other reason when user selects "Lainnya"
    condition:
      - active_loop: report_form
      - slot_was_set:
        report_reasons: "5" # Ini perlu disesuaikan dengan logika untuk mengecek jika "5" ada dalam list
    steps:
      - action: utter_ask_other_reason
